2011-01-19 Pierre Wieser <pwieser@trychlos.org>

	* tools/check-po.sh: Script rewriting.

	* NEWS: Update before release.

2011-01-16 Pierre Wieser <pwieser@trychlos.org>

	* run-distcheck.sh: New file.

	Add a script to check completeness of header files.

	* tools/.gitignore:
	* tools/Makefile.am:
	* tools/check-headers.sh: New files.

	* src/test/test-include.c:
	Renamed as tools/check-header.c and set it as ignored by git.

	* src/test/.gitignore:
	* src/test/Makefile.am: Updated accordingly.

	* Makefile.am:
	* configure.ac: configure in tools/.

2011-01-15 Pierre Wieser <pwieser@trychlos.org>

	* tools/init-finalize-diff.sh: Fix the interpretation of debug messages.

	* src/test/test-module.c:
	* src/test/test-module-plugin.c: New files.

	* src/test/.gitignore:
	* src/test/Makefile.am: Updated accordingly.
	 
	* src/nact/nact-schemes-list.c: Remove gconf-client.h include.

	* src/nact/base-iprefs.c
	(base_iprefs_position_named_window): Do not force a null window size or position.

	* src/core/na-settings.c
	(na_settings_get_string_list): Do not allocate an empty string list.

	* src/core/na-pivot.c (instance_dispose): Release the NASettings object.

	* src/core/na-object-id.c:
	* src/core/na-object-item.c: Remove no more used instance_init debug messages.

	* src/core/na-data-boxed.c:
	* src/core/na-gconf-monitor.c:
	* src/core/na-io-provider.c:
	* src/core/na-tokens.c:
	* src/core/na-updater.c:
	* src/io-desktop/nadp-desktop-file.c:
	* src/io-desktop/nadp-desktop-provider.c:
	* src/io-desktop/nadp-monitor.c:
	* src/io-gconf/nagp-gconf-provider.c:
	* src/io-xml/naxml-provider.c:
	* src/nact/base-application.c:
	* src/nact/base-builder.c:
	* src/nact/base-window.c: 
	* src/nact/nact-application.c:
	* src/nact/nact-clipboard.c:
	* src/nact/nact-main-window.c:
	* src/nact/nact-tree-model.c:
	* src/nact/nact-window.c: Add instance_finalize debug message.

	* src/core/na-core-utils.c (na_core_utils_slist_dump): Display string length.

	* src/core/na-boxed.c
	(na_boxed_free): Only free a non null structure.
	(na_boxed_new_from_string_with_sep): Do not try to split an empty string.
	(na_boxed_get_boolean, na_boxed_get_pointer, na_boxed_get_string,
	na_boxed_get_string_list, na_boxed_get_uint, na_boxed_get_uint_list):
	Do not try to return a value for a null structure.

	* m4/na-maintainer-mode.m4: Define a conditional when in maintainer mode.

2011-01-14 Pierre Wieser <pwieser@trychlos.org>

	* src/utils/na-delete-xmltree.c:
	* src/utils/nautilus-actions-print.c: Add localization code.

	* src/utils/nautilus-actions-new.c:
	* src/utils/nautilus-actions-run.c:
	* src/utils/nautilus-actions-schemas.c: Add locale.h include.

	* src/core/na-boxed.c (boxed_new, na_boxed_copy, na_boxed_new_from_string,
	na_boxed_new_from_string_with_sep, na_boxed_free):
	Add debug messages when allocating/freeing a NABoxed structure.

	* src/nact/nact-icommand-tab.c (on_wdir_browse):
	Remove no more used default value.

	* src/nact/nact-icon-chooser.c
	(fillup_icons_by_path, on_path_selection_changed): Store last folder uri.

	* src/core/na-settings.h: Preference renamed accordingly.

	* README-GCONF:
	* src/core/na-settings.h:
	* src/utils/na-gconf2key.sh.in:
	'-last-folder-uri' preferences are renamed as '-lfu'.

	* src/core/na-settings.c: Set default values.

	* src/nact/nact-gtk-utils.c:
	* src/nact/nact-gtk-utils.h (nact_gtk_utils_select_file,
	nact_gtk_utils_select_file_with_preview, nact_gtk_utils_select_dir):
	Remove no more used default value.

	* src/nact/nact-icommand-tab.c (on_path_browse, on_wdir_browse):
	* src/nact/nact-ienvironment-tab.c (on_try_exec_browse,
	on_show_if_running_browse): Updated accordingly.

	* src/core/na-boxed.c (string_list_from_array, uint_list_from_array):
	Do not allocate the empty last element.

	* src/core/na-io-provider.c (load_items_get_merged_list):
	* src/core/na-iprefs.c (na_iprefs_get_io_providers):
	Use the correct list pointer.

	* src/core/na-iprefs.c:
	* src/core/na-iprefs.h
	(na_iprefs_get_export_format, na_iprefs_set_export_format):
	Functions moved from src/nact/nact-iprefs.c.

	* src/nact/nact-iprefs.c:
	* src/nact/nact-iprefs.h: Removed files.

	* src/nact/Makefile.am:
	* src/nact/base-window.c:
	* src/nact/nact-assistant-export.c:
	* src/nact/nact-assistant-import.c:
	* src/nact/nact-clipboard.c:
	* src/nact/nact-export-ask.c:
	* src/nact/nact-export-format.c:
	* src/nact/nact-gtk-utils.c:
	* src/nact/nact-iaction-tab.c:
	* src/nact/nact-icommand-tab.c:
	* src/nact/nact-ifolders-tab.c:
	* src/nact/nact-main-toolbar.c:
	* src/nact/nact-preferences-editor.c:
	* src/nact/nact-tree-model-dnd.c: Updated accordingly.

	* src/nact/nact-iprefs.c:
	* src/nact/nact-iprefs.h (nact_iprefs_write_bool, nact_iprefs_write_uint,
	nact_iprefs_write_string): Remove deprecated functions.

	* src/nact/nact-main-toolbar.c (nact_main_toolbar_activate):
	Updated accordingly.

	* src/nact/base-iprefs.c:
	* src/nact/base-iprefs.h (base_iprefs_get_int, base_iprefs_set_int):
	Remove deprecated functions.

	* src/nact/nact-icon-chooser.c (instance_dispose, on_base_runtime_init_dialog):
	* src/nact/nact-main-window.c (instance_dispose, on_base_initial_load_toplevel):
	Updated accordingly.

	* src/nact/nact-iprefs.c:
	* src/nact/nact-iprefs.h (nact_iprefs_migrate_key): Remove deprecated function.

	* src/nact/nact-icommand-tab.c (nact_icommand_tab_initial_load_toplevel):
	Updated accordingly.

	Global renaming of preferences.

	* README-GCONF:
	* src/api/na-iio-provider.h:
	* src/core/na-export-format.h:
	* src/core/na-exporter.h:
	* src/core/na-importer-ask.h:
	* src/core/na-importer.c:
	* src/core/na-io-provider.c:
	* src/core/na-io-provider.h:
	* src/core/na-iprefs.c:
	* src/core/na-iprefs.h:
	* src/core/na-module.c:
	* src/core/na-pivot.c:
	* src/core/na-pivot.h:
	* src/core/na-settings.c:
	* src/core/na-settings.h:
	* src/core/na-updater.c:
	* src/nact/nact-add-capability-dialog.c:
	* src/nact/nact-add-scheme-dialog.c:
	* src/nact/nact-assistant-export.c:
	* src/nact/nact-assistant-import.c:
	* src/nact/nact-clipboard.c:
	* src/nact/nact-export-ask.c:
	* src/nact/nact-gtk-utils.c:
	* src/nact/nact-iactions-list.c:
	* src/nact/nact-icommand-tab.c:
	* src/nact/nact-icon-chooser.c:
	* src/nact/nact-ienvironment-tab.c:
	* src/nact/nact-ifolders-tab.c:
	* src/nact/nact-iprefs.c:
	* src/nact/nact-iprefs.h:
	* src/nact/nact-main-menubar-edit.c:
	* src/nact/nact-main-menubar-file.c:
	* src/nact/nact-main-menubar.c:
	* src/nact/nact-main-toolbar.c:
	* src/nact/nact-main-window.c:
	* src/nact/nact-preferences-editor.c:
	* src/nact/nact-providers-list.c:
	* src/nact/nact-schemes-list.c:
	* src/nact/nact-sort-buttons.c:
	* src/nact/nact-tree-model-dnd.c:
	* src/nact/nact-tree-model.c:
	* src/nact/nact-window.c:
	* src/nact/nact-window.h:
	* src/plugin-menu/nautilus-actions.c:
	* src/utils/na-gconf2key.sh.in:
	* src/utils/nautilus-actions-new.c: Rename preferences.
>>>>>>> Globally rename preferences

2011-01-13 Pierre Wieser <pwieser@trychlos.org>

	* src/core/na-settings.c:
	* src/core/na-settings.h: Preference names are defined as '#define' values.

	* README-GCONF:
	* src/utils/na-gconf2key.sh.in: Adjust preferences.

	* src/core/na-iprefs.c:
	* src/core/na-iprefs.h: NAIPrefs is no more an interface.

	* src/api/na-iimporter.h:
	* src/core/na-importer-ask.c:
	* src/core/na-importer-ask.h:
	* src/core/na-importer.c: Updated accordingly.

2011-01-12 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/nact-iprefs.c:
	* src/nact/nact-iprefs.h: Get ride of GConf.

	* README-GCONF:
	* src/core/na-settings.c:
	* src/utils/na-gconf2key.sh.in: Add omitted 'export-ask-user-last-format' key.

	* src/nact/nact-icommand-tab.c:
	* src/nact/nact-ienvironment-tab.c: Update to new preferences.

	* README-GCONF:
	* src/core/na-settings.c:
	* src/utils/na-gconf2key.sh.in:
	'folder-last-path' key is renamed as 'folder-last-folder-uri'.

	* src/nact/nact-ifolders-tab.c: Updated accordingly.

	* README-GCONF:
	* src/core/na-settings.c:
	* src/utils/na-gconf2key.sh.in: Add 'export-ask-user-wsp' preference.

	* src/nact/nact-add-capability-dialog.c (base_get_iprefs_window_id):
	* src/nact/nact-add-scheme-dialog.c (base_get_iprefs_window_id):
	* src/nact/nact-assistant-export.c (window_get_iprefs_window_id):
	* src/nact/nact-assistant-import.c (window_get_iprefs_window_id):
	* src/nact/nact-export-ask.c (base_get_iprefs_window_id):
	* src/nact/nact-main-window.c
	(instance_dispose, base_get_iprefs_window_id):
	* src/nact/nact-preferences-editor.c (base_get_iprefs_window_id):
	Update all preference names when saving/restoring window size and position.

	* src/core/na-settings.c:
	* src/core/na-settings.h: All getters/setters are implemented.

	* src/nact/base-iprefs.c: Remove GConf stuff.

	* src/nact/nact-icon-chooser.c:
	* src/nact/nact-icon-chooser.ui: Implement all preferences.

	* src/utils/na-gconf2key.sh.in:
	Renamed preferences for windows size and position '-wsp'.
	Also delete from GConf if only preferences have been migrated.
	Re-sync after tree delete.

	* src/api/na-boxed.h:
	* src/core/na-boxed.c
	(na_boxed_get_string, na_boxed_get_uint, na_boxed_get_uint_list):
	New functions.

	* configure.ac: Enable silent rules by default.

	* run-autogen.sh: Add sysconfdir argument to autogen.sh

	* src/nact/nact-gtk-utils.c (nact_gtk_utils_get_pixbuf):
	Search a pixbuf by icon theme if not found as filename or stock.

	* src/nact/base-window.c:
	* src/nact/base-window.h (base_window_peek_widget): New function.

	* src/nact/nact-icon-chooser.c:
	* src/nact/nact-icon-chooser.h:
	* src/nact/nact-icon-chooser.ui: New files.
	
	* src/nact/Makefile.am:
	* src/nact/nact-iaction-tab.c:
	* src/nact/nautilus-actions-config-tool.ui: Updated accordingly.

	* src/core/na-settings.c (content_load_keys):
	Do not warn if configuration file does not exist.

	* src/api/na-boxed.h:
	* src/api/na-data-boxed.h:
	* src/api/na-data-types.h:
	* src/core/na-boxed.c:
	* src/core/na-data-boxed.c:
	* src/core/na-data-types.c:
	Update reference documentation to deprecate NADataBoxed and NADataType
	in favor of NABoxed.

	* src/core/na-settings.c:
	* src/core/na-settings.h: Configuration monitoring.

	* src/plugin-menu/nautilus-actions.c:
	Monitor all runtime preferences with only one callback.

	* src/api/na-boxed.h:
	* src/core/na-boxed.c (na_boxed_get_pointer): New function.

	* run-autogen.sh: Add sysconfdir argument to autogen.sh.

	* src/api/na-data-types.h:
	* src/core/na-data-types.c
	(na_data_types_copy, na_data_types_free): Removed functions.

	* README-GCONF:
	* src/utils/na-gconf2key.sh.in: Fix two key label conversions.

	* src/api/na-boxed.h:
	* src/core/na-boxed.c: New files.

	* src/api/Makefile.am:
	* src/core/Makefile.am: Updated accordingly.

2011-01-10 Pierre Wieser <pwieser@trychlos.org>

	* src/api/na-data-types.h:
	* src/core/na-data-types.c
	(na_data_types_copy, na_data_types_free, na_data_types_get_label):
	New functions.

	* src/core/na-settings.c
	(monitor_io_provider_read_status, monitor_key): Register monitored keys.

	* src/core/na-settings.h
	(na_settings_get_boolean_ex, na_settings_get_string_list):
	New functions.

	* src/plugin-menu/nautilus-actions.c:
	Implement runtime preferences monitoring.
	No more use deprecated na_pivot_set_automatic_reload().

	* src/core/na-pivot.c:
	* src/core/na-pivot.h:
	Replace GConf preferences monitoring with NASettings.
	Define new PIVOT_SIGNAL_ITEMS_CHANGED signal.

	* src/core/na-settings.c:
	* src/core/na-settings.h
	(na_settings_register_key_callback,
	na_settings_register_global_callback, na_settings_get_boolean):
	New functions.

	* src/api/na-iio-provider.h:
	* src/core/na-io-provider.h: IIO_PROVIDER_SIGNAL_ITEM_CHANGED signal
	definition is moved (and renamed) from public API to internal one.

	* src/core/na-iio-provider.c (interface_base_init):
	* src/core/na-io-provider.c (io_provider_set_provider):
	* src/core/na-pivot.c (on_item_changed_timeout): Updated accordingly.

	* src/core/na-iio-provider.c
	* src/core/na-settings.c (na_settings_new):
	* src/utils/na-gconf2key.sh.in: Global configuration file goes to /etc/xdg.

	* src/core/na-pivot.c:
	* src/core/na-pivot.h (na_pivot_register):
	* src/core/na-settings.c:
	* src/core/na-settings.h (na_settings_register):
	* src/plugin-menu/nautilus-actions.c (instance_constructed):
	Fix compilation.

2011-01-09 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/base-application.c (display_dlg): Setup parent window.

	* src/api/na-iimporter.h:
	* src/core/na-io-provider.c:
	* src/core/na-object-id.c:
	* src/core/na-object-item.c:
	* src/io-desktop/nadp-utils.c:
	* src/nact/nact-assistant-import.c:
	* src/nact/nact-iactions-list-bis.c:
	* src/nact/nact-iactions-list.h:
	* src/nact/nact-main-window.c:
	* src/nact/nact-preferences.ui:
	* src/nact/nact-tree-model.c: Remove all deprecated references to an UUID.

	* po/POTFILES.in: Add src/io-desktop/nadp-formats.c file.

	* src/core/na-object-profile-factory.c:
	Remove %o/%O parameters from description of version 2.0.
	Add a missing line feed.

	* tools/check-po.sh: Adapt to glade files.

2011-01-08 Pierre Wieser <pwieser@trychlos.org>

	* src/utils/nautilus-actions-new.c (init_options):
	* src/utils/nautilus-actions-run.c (init_options):
	* src/utils/nautilus-actions-schemas.c (init_options):
	Initialize translation domain for GOptionContext.

	* src/core/na-data-boxed.c
	(string_spec, slist_spec, bool_spec, pointer_spec, uint_spec):
	* src/core/na-export-format.c
	(na_export_format_get_label, na_export_format_get_description):
	* src/core/na-iabout.c (na_iabout_display):
	* src/core/na-object-action.c (na_object_action_new_with_defaults):
	* src/core/na-object-menu.c (na_object_menu_new_with_defaults):
	* src/io-xml/naxml-writer.c (write_data_schema_v1_element):
	* src/nact/nact-add-capability-dialog.c (on_base_runtime_init_dialog):
	* src/nact/nact-ienvironment-tab.c (nact_ienvironment_tab_runtime_init_toplevel):
	* src/nact/nact-iproperties-tab.c (on_tab_updatable_selection_changed):
	* src/nact/nact-main-menubar-file.c (nact_main_menubar_file_save_items):
	* src/nact/nact-match-list.c (get_must_match_header, insert_new_row):
	* src/nact/nact-tree-model-dnd.c
	(is_drop_possible, is_drop_possible_before_iter,
	is_drop_possible_into_dest, is_parent_accept_new_childs):
	Use gettext() to display localized static strings.

	* src/api/na-data-def.h: Complete the description of the fields.

	* src/core/na-io-provider.c:
	* src/core/na-object-profile-factory.c:
	* src/nact/nact-assistant-export.ui:
	* src/nact/nautilus-actions-config-tool.ui:
	Fix various mistakes and mispellings reported by Fr translation team.

	* configure.ac: Post-release bump version number.

2011-01-07 Pierre Wieser <pwieser@trychlos.org>

	* src/core/na-pivot.c (na_pivot_register): New function.

	* src/plugin-menu/nautilus-actions.c:
	Replace NAIPivotConsumer interface with na_settings() accessors.

	* src/core/na-settings.c:
	* src/core/na-settings.h: New files.

	* src/utils/na-gconf2key.sh.in:
	Make sure that GConf is at the end of the list of I/O providers.
	Make sure that GConf is locked.
	Migrate all I/O provider preferences.

	* configure.ac:
	* src/utils/Makefile.am:
	* src/utils/na-gconf2key.sh.in:
	nautilus-actions-gconf2desktop.sh.in is renamed as na-gconf2key.sh.in,
	and is installed in PKGLIBEXECDIR.

	* src/core/Makefile.am:
	* src/core/na-gconf-migration.c: Updated accordingly.

	* src/utils/Makefile.am:
	nautilus-actions-delete is renamed as na-delete-xmltree,
	and is installed in PKGLIBEXECDIR.

	* src/core/na-core-utils.c (na_core_utils_print_version):
	Print the compilation version of GLib2 and Gtk+ when in debug mode.

	* src/utils/Makefile.am:
	nautilus-actions-schemas is renamed as na-print-schemas,
	and is installed in PKGLIBEXECDIR.

2011-01-06 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/nact-main-window.c (iabout_get_toplevel):
	Let the About dialog get the toplevel window.

	* src/nact/nact-preferences.ui:
	* src/nact/nautilus-actions-config-tool.ui:
	Apply patch provided by Christian Kirbach. Fix #638548.

	Use the same script to migrate items and preferences.

	* README-GCONF: Document migrated and renamed preferences.

	* src/utils/nautilus-actions-gconf2desktop.sh.in:
	Rewrite migrated preferences as keyed files.
	At last, remove the whole Nautilus-Actions tree from GConf.

2011-01-05 Pierre Wieser <pwieser@trychlos.org>

	* src/utils/console-utils.c (console_cmdline_get_description):
	Returns the full address of the page to enter a new bug in Bugzilla.

	* src/core/na-gconf-migration.c:
	* src/core/na-gconf-migration.h (na_gconf_migration_run): New function.

	* src/core/Makefile.am: Updated accordingly.

	* src/nact/nact-main.c (main):
	* src/plugin-menu/nautilus-module.c (nautilus_module_initialize):
	* src/utils/nautilus-actions-new.c (main):
	* src/utils/nautilus-actions-run.c (main):
	Automatically run the migration tool at startup.

	* src/utils/nautilus-actions-gconf2desktop.sh.in:
	* src/utils/nautilus-actions-delete.c:
	* src/utils/nautilus-actions-print.c:
	New items migration script and programs.
	They take care of migrating users and mandatory items to .desktop files.

	* configure.ac:
	* src/utils/Makefile.am:
	* src/utils/.gitignore: Updated accordingly.

2011-01-04 Pierre Wieser <pwieser@trychlos.org>

	* src/core/na-tokens.c (na_tokens_new_from_selection):
	No more prepare the list string of selection.
	Directly build the selection list in the correct order.
	(execute_action_command): Setup the working directory.

	* src/core/na-tokens.c:
	* src/core/na-tokens.h (na_tokens_parse_parameters):
	Renamed as na_tokens_parse_for_display() as filenames are not quoted
	when displayed as part of an expanded label.

	* src/nact/nact-icommand-tab.c (parse_parameters):
	* src/plugin-menu/nautilus-actions.c (expand_tokens_item):
	Updated accordingly.

	* configure.ac: Fix "API Reference generation" message.

	* m4/na-enable-manuals.m4:
	Better specify that --enable-html-manuals (resp. pdf) are for user's manuals.

	* src/core/na-selected-info.c (new_from_uri):
	- Add an excerpt from RFC 2396 about valid characters in URIs.
	- Prefer the filename from g_filename_from_uri() when possible.

	* src/core/na-tokens.c
	(na_tokens_new_from_selection): Also g_shell_quote() the URI to preserve quotes.
	(build_string_lists_item): Removed function.

	* src/core/na-iabout.c (na_iabout_display):
	Fix typo in comment, adding a note to the translators.

2011-01-03 Pierre Wieser <pwieser@trychlos.org>

	* src/core/na-io-provider.c:
	* src/core/na-io-provider.h (na_io_provider_are_writings_authorized):
	New function.

	* configure.ac: Define a conditional if we have both GSettings and GConf.

	* src/core/na-gsettings-migrate.c:
	* src/core/na-gsettings-migrate.h: New files.

	* src/core/Makefile.am: Updated accordingly.

	* src/core/na-pivot.c (instance_constructed):
	Call na_gsettings_migrate() if we have both GSettings and GConf.

	* configure.ac:
	- Define HAVE_GSETTINGS variable.
	- Define HAVE_GCONF variable.

2011-01-02 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/egg-desktop-file.c:
	Get ride of tests for Gtk+ 2.12.0 as this is the minimal required version.

	* src/nact/base-keysyms.h:
	* src/nact/egg-sm-client-private.h:
	* src/nact/egg-sm-client-xsmp.c: 
	* src/nact/nact-add-capability-dialog.c:
	* src/nact/nact-add-scheme-dialog.c:
	* src/nact/nact-main-tab.c:
	* src/nact/nact-clipboard.c:
	* src/nact/nact-tree-model-dnd.c:
	* src/nact/nact-gtk-utils.c:
	* src/nact/nact-iaction-tab.c:
	* src/nact/nact-main-statusbar.c:
	* src/nact/nact-main-menubar.c:
	* src/nact/nact-schemes-list.c: Use GTK_CHECK_VERSION macro.

	* configure.ac:
	* m4/na-check-for-gtk.m4:
	Move back gtk_required variable to improve readibility of configure.ac.

2011-01-01 Pierre Wieser <pwieser@trychlos.org>

	* configure.ac: Post release version bump.

	* NEWS: Update NEWS before release.

	* src/plugin-menu/nautilus-actions.c (create_root_menu):
	Update the root menu label to better reflect the product name.

	* src/nact/nautilus-actions-config-tool.ui:
	Use gtk-find instead of gtk-find-and-replace stock icon for browse buttons.

	* src/nact/nact-iaction-tab.c (nact_iaction_tab_initial_load_toplevel):
	Display again stock icons in NACT.
	Fix #638461 - Stock icons are no more displayed in NACT.

	* Almost all files modified:
	Update copyright message.
	Set Nautilus-Actions as being the actual official product name.

	* src/core/na-selected-info.c (new_from_nautilus_file_info):
	Fix pathname breakdown for 'x-nautilus-desktop:///' URI.
	Fix #638450 - Nautilus crashes when opening Trash or Network.
