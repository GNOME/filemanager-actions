2012-01-11 Pierre Wieser <pwieser@trychlos.org>

	* BASE_SIGNAL_QUIT_REQUESTED, BASE_SIGNAL_QUIT: New signals, defined in
	BaseISession interface.

	* src/nact/nact-marshal.def: New file.

	* src/nact/Makefile.am: Updated accordingly.

	* src/nact/base-application.c
	* src/nact/base-application.h
	(register_type): As BaseISession now only requires G_TYPE_OBJECT, then 
	declare the implementation in register_type().
	(base_application_run): Renamed as base_application_run_with_args().
	BASE_EXIT_CODE_START_FAIL exit code replaced with BASE_EXIT_CODE_PROGRAM.
	(base_application_is_willing_to_quit): New function, moved from BaseWindow.
	BASE_APPLICATION_TYPE macro renamed as BASE_TYPE_APPLICATION.

	* src/nact/base-assistant.c (do_run):
	* src/nact/base-dialog.c (do_run):
	* src/nact/nact-application.c (register_type):
	* src/nact/nact-main-window.c:
	* src/nact/nact-menubar-maintainer.c:
	* src/nact/nact-tree-view.c: Updated accordingly.

	* src/nact/base-isession.c:
	* src/nact/base-isession.h:
	Define ISessionData pseudo-properties.
	Implement BASE_SIGNAL_QUIT_REQUESTED and BASE_SIGNAL_QUIT class handlers.

	* src/nact/base-iunique.c:
	* src/nact/base-iunique.h:
	Define IUniqueData pseudo-properties.

	* src/nact/base-window.c:
	* src/nact/base-window.h:
	Define BaseGtkData pseudo-properties.
	Remove BASE_SIGNAL_WILLING_TO_QUIT definition and handlers.
	(base_window_is_willing_to_quit): Removed function.

2012-01-09 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/base-isession.c:
	* src/nact/base-isession.h: New BaseISession interface.

	* src/nact/Makefile.am:
	* src/nact/base-application.c (init_session_manager): Updated accordingly.

	* src/nact/base-application.h: Update comments.

	* src/nact/base-window.c:
	* src/nact/base-window.h (base_window_init) now holds all the build process.

	* src/nact/nact-main-window.c (instance_dispose): Quit the main loop.

	* src/nact/base-window.c:
	* src/nact/base-window.h
	(BASE_SIGNAL_ALL_WIDGETS_SHOWED): signal renamed as BASE_SIGNAL_SHOW_WIDGETS.
	(instance_constructed): Gtk toplevel initialization is moved here.
	(base_window_init): only deals with runtime initialization and widgets display.
	(do_initialize_base_window): set transient for parent here.

	* src/nact/nact-add-capability-dialog.c (instance_init):
	* src/nact/nact-add-scheme-dialog.c (instance_init):
	* src/nact/nact-assistant-export.c (instance_constructed):
	* src/nact/nact-icon-chooser.c (instance_init):
	* src/nact/nact-preferences-editor.c (instance_init):
	* src/nact/nact-tree-view.c (instance_constructed): Updated accordingly.

	* src/nact/nact-main-window.c
	(instance_init): Connect to BaseWindow signals before running
	instance_constructed().
	(nact_main_window_new): Call base_window_init().

	* src/nact/nact-application.h: Review comments.

	* src/nact/nact-application.c (appli_create_windows): Fix return value.

	* src/nact/base-application.h: Fix comments.

	* src/nact/base-application.c (base_application_run):
	Add a debug message before entering the main loop.

2012-01-08 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/base-application.c:
	* src/nact/base-application.h
	(base_application_get_builder): Removed function.
	Implements BaseIUnique interface.

	* src/nact/base-window.c:
	* src/nact/base-window.h:
	Have a common builder at class level.
	Gtk toplevel and BaseWindow are initialized when instance is constructed.

	* src/nact/nact-application.c: Updated accordingly.

	* src/nact/base-iunique.c:
	* src/nact/base-iunique.h (base_iunique_init_with_name):
	Function renamed from base_iunique_init_name().
	* src/nact/base-builder.c:
	* src/nact/base-builder.h: Fix comments.

	* src/nact/nact-tree-view.c (nact_tree_view_get_type):
	Register the interface after the type so that the interface is able to
	require the type.

	A program to test a class which implements an interface, this same
	interface itself requiring the class...

	* src/test/test-iface2.c: New interface test program.

	* src/test/Makefile.am: Updated accordingly.

	Rather call parent_class::instance_constructed() method before executing
	the derived class one.

	* src/core/na-io-provider.c (instance_constructed):
	* src/core/na-pivot.c (instance_constructed):
	* src/nact/nact-assistant-export.c (instance_constructed):
	* src/nact/nact-main-window.c (instance_constructed):
	* src/nact/nact-tree-view.c (instance_constructed):
	* src/plugin-menu/nautilus-actions.c (instance_constructed):
	Call parent class on the beginning of the function.

	* src/nact/base-iunique.c:
	* src/nact/base-iunique.h: New BaseIUnique interface.

	* src/nact/Makefile.am: Updated accordingly.

2012-01-06 Pierre Wieser <pwieser@trychlos.org>

	* configure.ac: Now requires gtk-doc >= 1.16.

	* src/nact/base-application.c:
	* src/nact/base-application.h (base_application_run):
	Take argc, argv as function arguments.
	Define 'code' as a property.

	* src/nact/main.c b/src/nact/main.c (main):
	* src/nact/nact-application.c (appli_manage_options): Updated accordingly.

2012-01-05 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/nact-tree-ieditable.c:
	* src/nact/nact-tree-ieditable.h (nact_tree_ieditable_set_items): New function.

	* src/nact/nact-assistant-import.c (assistant_apply):
	* src/nact/nact-tree-model-dnd.c (drop_uri_list): Updated accordingly.

	* src/core/na-importer.c (manage_import_mode):
	Release the duplicated object which has been cancelled by the user.

	* src/core/na-icontext-factory.c:
	* src/core/na-iduplicable.c:
	* src/core/na-object-action-factory.c:
	* src/core/na-object-action.c:
	* src/core/na-object-id-factory.c:
	* src/core/na-object-item-factory.c:
	* src/core/na-object-menu-factory.c: Add/fix comments.

	* src/core/na-export-format.h: Remove IPREFS_EXPORT_ definitions from here.

	* src/core/na-exporter.c:
	* src/core/na-exporter.h (na_exporter_get_export_format): New function.

	* src/core/na-iprefs.c:
	* src/core/na-iprefs.h
	(na_iprefs_get_export_format, na_iprefs_set_export_format): Removed functions.

	* src/nact/nact-assistant-export.c
	(on_base_initialize_base_window, assist_prepare_confirm, assist_prepare_exportdone):
	* src/nact/nact-clipboard.c (export_row_object):
	* src/nact/nact-export-ask.c (nact_export_ask_user, get_export_format):
	* src/nact/nact-export-ask.h:
	Updated accordingly.
	
	* src/core/na-iprefs.c:
	* src/core/na-iprefs.h (na_iprefs_set_import_mode): Removed function.

2012-01-04 Pierre Wieser <pwieser@trychlos.org>

	Move 'Ask' export format to NAExporter.

	* src/core/Makefile.am:
	* src/nact/Makefile.am: Move export-format-ask.png to src/core.

	* nact-export-format.c:
	* nact-export-format.h: Removed files.

	* po/POTFILES.in:
	* src/nact/nact-assistant-export.c (ioptions_list_get_ask_option):
	* src/nact/nact-preferences-editor.c (ioptions_list_get_ask_option):
	Updated accordingly.

	* src/api/na-iimporter.h: Deprecate NAIImporterImportMode enum.

	* src/core/na-importer.h: Define new NAImporterImportMode enum here.

	* src/core/na-importer.c (ask_user_for_mode):
	* src/core/na-iprefs.c:
	* src/core/na-iprefs.h:
	* src/nact/nact-tree-model-dnd.c:
	Get ride of na_iprefs_get_import_mode() function.

	Review interface initialization in implementations.

	* src/core/na-export-format.c (ioption_iface_init):
	* src/core/na-import-mode.c (ioption_iface_init):
	* src/core/na-importer-ask.c (ioptions_list_iface_init):
	* src/core/na-object-action.c
	(ifactory_object_iface_init, icontext_iface_init):
	* src/core/na-object-menu.c
	(ifactory_object_iface_init, icontext_iface_init):
	* src/core/na-object-profile.c
	(ifactory_object_iface_init, icontext_iface_init):
	* src/core/na-object.c (iduplicable_iface_init):
	* src/nact/nact-assistant-export.c (ioptions_list_iface_init):
	* src/nact/nact-assistant-import.c (ioptions_list_iface_init):
	* src/nact/nact-export-ask.c (ioptions_list_iface_init):
	* src/nact/nact-main-window.c
	(iaction_tab_iface_init, icommand_tab_iface_init,
	ibasenames_tab_iface_init, imimetypes_tab_iface_init,
	ifolders_tab_iface_init, ischemes_tab_iface_init,
	icapabilities_tab_iface_init, ienvironment_tab_iface_init,
	iexecution_tab_iface_init, iproperties_tab_iface_init):
	* src/nact/nact-preferences-editor.c (ioptions_list_iface_init):
	* src/nact/nact-tree-model.c
	(imulti_drag_source_init, idrag_dest_init):
	* src/nact/nact-tree-view.c (tree_ieditable_iface_init):
	* src/test/test-iface-base.c (iface_iface_init): Add user_data parameter.

	* src/nact/nact-tree-ieditable.c: Review NactTreeIEditable interface.

	* src/nact/nact-ischemes-tab.c: Review NactISchemesTab interface.

	* src/nact/nact-iproperties-tab.c: Review NactIPropertiesTab interface.

	* src/nact/nact-imimetypes-tab.c: Review NactIMimetypesTab interface.

	* src/nact/nact-ifolders-tab.c: Review NactIFoldersTab interface.

	* src/nact/nact-iexecution-tab.c: Review NactIExecutionTab interface.

	* src/nact/nact-ienvironment-tab.c: Review NactIEnvironmentTab interface.

	* src/nact/nact-icommand-tab.c: Review NactICommandTab interface.

	* src/nact/nact-icapabilities-tab.c: Review NactICapabilitiesTab interface.

	* src/nact/nact-ibasenames-tab.c: Review NactIBasenamesTab interface.

	* src/nact/nact-iaction-tab.c: Review NactIActionTab interface.

	Come back on core interfaces.

	* src/core/na-icontext.c:
	* src/core/na-iduplicable.c:
	* src/core/na-iexporter.c:
	* src/core/na-ifactory-object.c:
	* src/core/na-ifactory-provider.c:
	* src/core/na-iimporter.c:
	* src/core/na-iio-provider.c:
	* src/core/na-ioption.c:
	* src/core/na-ioptions-list.c
	(interface_init): Renamed back as interface_base_init().
	(interface_finalize): Renamed back as interface_base_finalize().

	* src/utils/console-utils.h: Re-include 'glib.h' header.

2012-01-03 Pierre Wieser <pwieser@trychlos.org>

	* src/core/na-ioptions-list.c: Review NAIOptionsList interface.

	* src/core/na-ioption.c: Review NAIOption interface.

	* src/core/na-iio-provider.c: Review NAIIOProvider interface.

	* src/core/na-iimporter.c:
	* src/core/na-importer.c: Review NAIImporterInterface.

	* src/core/na-factory-provider.c:
	* src/core/na-ifactory-provider.c: Review NAIFactoryProvider interface.

	* src/core/na-factory-object.c:
	* src/core/na-ifactory-object.c: Review NAIFactoryObject interface.

	* src/core/na-exporter.c:
	* src/core/na-iexporter.c: Review NAIExporter interface.

	* src/core/na-iduplicable.c: Review NAIDuplicable interface.

	* src/core/na-icontext.c: Review NAIContext interface.

	* src/test/test-iface-iface.c:
	* src/test/test-iface.c: Do some more tests on the interfaces.

	* src/utils/na-gconf2key.sh.in: Force GConf I/O provider to be read-only.

	* src/utils/console-utils.h: Remove superfluous 'glib-object.h' include.

	* src/utils/na-set-conf.c: New program.

	* src/core/na-settings.c:
	* src/core/na-settings.h
	(na_settings_set_string_ex,	na_settings_set_int_ex): New functions.

	* src/utils/Makefile.am: Updated accordingly.

	* src/utils/Makefile.am: Factorize library declarations.

2012-01-02 Pierre Wieser <pwieser@trychlos.org>

	* src/utils/na-gconf2key.sh.in:
	Introduces new '--admin' option for packagers and system administrators.
	Default for GConf to be only readable.

	* src/api/na-iimporter.h:
	* src/core/na-iimporter.c: Introduces version 2 of interface,
	deprecating NAIImporterCheckFn and NAIImporterAskUserFn definitions.

	* src/core/na-importer.c:
	* src/core/na-importer.h (na_importer_import_from_uris):
	Updated to new NAIImporter v2 interface, moving check and ask code here.

	* src/io-desktop/nadp-desktop-provider.c (iimporter_get_version):
	* src/io-desktop/nadp-reader.c (nadp_reader_iimporter_import_from_uri):
	* src/io-xml/naxml-provider.c (iimporter_get_version):
	* src/io-xml/naxml-reader.c (naxml_reader_import_from_uri):
	* src/nact/nact-assistant-import.c (assistant_apply):
	* src/nact/nact-tree-model-dnd.c (drop_uri_list):
	* src/test/test-reader.c (main):
	Updated to new NAIImporter v2 interface.

	* src/api/na-iexporter.h: Update documentation.

	* src/core/na-importer.c:
	* src/core/na-importer.h (na_importer_import_from_list):
	Renamed as na_importer_import_from_uris.
	Now returns the count of succesffully imported items.

	* src/nact/nact-assistant-import.c (assistant_apply):
	* src/nact/nact-tree-model-dnd.c (drop_uri_list):
	* src/test/test-reader.c (main): Updated accordingly.

	* src/api/na-iimporter.h: Update documentation.

	* m4/na-maintainer-mode.m4: Reverse the sens of deprecation test.

	* configure.ac:
	* docs/reference/Makefile.am:
	* src/api/na-core-utils.h:
	* src/api/na-data-boxed.h:
	* src/api/na-gconf-monitor.h:
	* src/api/na-gconf-utils.h:
	* src/api/na-iduplicable.h:
	* src/api/na-iexporter.h:
	* src/api/na-object-api.h:
	* src/api/na-object.h:
	* src/core/na-core-utils.c:
	* src/core/na-data-boxed.c:
	* src/core/na-exporter.c:
	* src/core/na-gconf-monitor.c:
	* src/core/na-gconf-utils.c:
	* src/core/na-iduplicable.c:
	* src/core/na-object.c:
	* src/io-gconf/nagp-gconf-provider.c:
	* src/io-gconf/nagp-writer.c:
	* src/io-gconf/nagp-writer.h: Updated accordingly.

	* src/core/na-importer.c (na_importer_import_from_list): Fix typo.

	* src/core/na-about.c:
	* src/core/na-about.h (na_about_get_icon_name): Returns a const string.

	* src/plugin-menu/nautilus-actions.c: Updated accordingly.

	* Allmost all files: Bump copyright year.

	* ChangeLog-2011: New file.

	* src/core/na-exporter.c (exporter_get_formats): Fix variable declaration.

	* src/api/na-core-utils.h:
	* src/core/na-core-utils.c (na_core_utils_str_add_prefix):
	Fix function deprecation.

2012-01-01 Pierre Wieser <pwieser@trychlos.org>

	* src/nact/export-format-ask.png: Add omitted image.

	* src/api/na-core-utils.h:
	* src/core/na-core-utils.c (na_core_utils_str_add_prefix): Deprecated function.

	* src/core/na-import-mode.c:
	* src/core/na-import-mode.h (na_import_mode_get_id): New function.

	* src/core/na-importer-ask.c (on_destroy_toplevel): Fix handler signature.

	* src/core/na-importer.c (get_mode_from_struct): Fix GdkPixbuf reference count.

	* src/core/na-ioption.h:
	* src/core/na-ioptions-list.c: Fix typo.

	* src/core/na-importer-ask.c:
	* src/nact/nact-assistant-import.c: Implement NAIOptionsList interface.
